<div class="space-y-6">

    <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-3">
            <div>
                <label class="block text-xs font-semibold text-slate-500 mb-1">Año</label>
                <select
                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:border-blue-500"
                    [value]="selectedYear()"
                    (change)="onYearChange($event)">
                    
                    <option *ngFor="let year of availableYears()" [value]="year">
                        {{ year }}
                    </option>

                    <option *ngIf="availableYears().length === 0" [value]="selectedYear()" disabled>
                        Cargando...
                    </option>
                </select>
            </div>

            <div>
                <label class="block text-xs font-semibold text-slate-500 mb-1">Mes</label>
                <select
                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:border-blue-500"
                    [value]="selectedMonth()"
                    (change)="onMonthChange($event)">
                    <option *ngFor="let m of meses" [value]="m.value">
                        {{ m.label }}
                    </option>
                </select>
            </div>
        </div>

        <div *ngIf="loading()" class="text-xs text-slate-500 animate-pulse">
            Cargando datos de unidades...
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div *ngFor="let u of unidadesMes()"
             class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-5 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                <h3 class="font-bold text-[#002777]">{{ u.unidad }}</h3>
                <span class="text-xs bg-white border border-slate-200 px-2 py-1 rounded text-slate-500">
                    {{ u.miembros }} miembros
                </span>
            </div>
            <div class="p-5 space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Pendientes</span>
                    <span class="font-bold text-slate-800">{{ u.pendientes }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">En Proceso</span>
                    <span class="font-bold text-slate-800">{{ u.en_proceso }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Cerrados en el mes</span>
                    <span class="font-bold text-slate-800">{{ u.cerrados }}</span>
                </div>
            </div>
            <div class="px-5 py-3 bg-slate-50 border-t border-slate-100 text-xs text-center text-slate-500">
                MTTR Mensual: <span class="font-bold text-[#002777]">{{ u.mttr_mensual }}h</span>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 mt-4">
        <div class="p-5 border-b border-slate-100 bg-slate-50">
            <h3 class="font-bold text-[#002777]">Resumen anual por unidad ({{ selectedYear() }})</h3>
        </div>
        <div class="p-5">
            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-slate-500 border-b">
                        <th class="pb-2">Unidad</th>
                        <th class="pb-2">Tickets cerrados en el año</th>
                        <th class="pb-2">MTTR promedio anual (hrs)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let r of unidadesAnual()" class="border-b last:border-0">
                        <td class="py-2 font-semibold text-slate-700">{{ r.unidad }}</td>
                        <td class="py-2">{{ r.totalCerrados }}</td>
                        <td class="py-2">{{ r.mttrPromedioAnual }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>