<div class="mx-auto space-y-6 pb-12">

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex items-center gap-5">
        <div class="bg-blue-50 p-4 rounded-xl flex items-center justify-center border border-blue-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#002777]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        </div>
        <div>
            <h1 class="text-2xl font-bold text-[#002777]">Gestión de Usuarios</h1>
            <p class="text-slate-500 mt-1">Administra roles, unidades y accesos del personal.</p>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <div>
                <label class="text-xs font-bold text-[#002777] mb-1 block ml-1">Buscar</label>
                <div class="relative">
                    <input type="text" 
                        [ngModel]="filtroBusqueda()" (ngModelChange)="filtroBusqueda.set($event)"
                        placeholder="Nombre o correo..." 
                        class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-lg focus:outline-none focus:border-[#002777] focus:ring-1 focus:ring-[#002777] transition-all text-sm">
                    <svg class="w-5 h-5 text-slate-400 absolute left-3 top-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-[#002777] mb-1 block ml-1">Rol</label>
                <select [ngModel]="filtroRol()" (ngModelChange)="filtroRol.set($event)"
                    class="w-full px-3 py-2.5 border border-slate-200 rounded-lg focus:outline-none focus:border-[#002777] focus:ring-1 focus:ring-[#002777] text-sm bg-white">
                    <option value="todos">Todos los roles</option>
                    <option value="1">Solicitante</option>
                    <option value="2">Soporte</option>
                    <option value="3">Administrador</option>
                </select>
            </div>

            <div>
                <label class="text-xs font-bold text-[#002777] mb-1 block ml-1">Unidad</label>
                <select [ngModel]="filtroUnidad()" (ngModelChange)="filtroUnidad.set($event)"
                    class="w-full px-3 py-2.5 border border-slate-200 rounded-lg focus:outline-none focus:border-[#002777] focus:ring-1 focus:ring-[#002777] text-sm bg-white">
                    <option value="todos">Todas las unidades</option>
                    <option value="1">Soporte</option>
                    <option value="2">Infraestructura</option>
                    <option value="3">Desarrollo</option>
                    <option value="null">Sin unidad</option>
                </select>
            </div>
        </div>
    </div>

    <div *ngIf="loading()" class="flex flex-col items-center justify-center py-12">
        <div class="w-10 h-10 border-4 border-[#62CEEA]/30 border-t-[#002777] rounded-full animate-spin"></div>
        <p class="mt-3 text-sm font-medium text-[#002777]">Cargando listado...</p>
    </div>

    <div *ngIf="!loading()" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="bg-[#002777] text-white text-xs uppercase tracking-wider font-bold text-left">
                        <th class="px-6 py-4">ID</th>
                        <th class="px-6 py-4">Usuario</th>
                        <th class="px-6 py-4">Rol</th>
                        <th class="px-6 py-4">Unidad</th>
                        <th class="px-6 py-4 text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    <tr *ngFor="let u of getPaginatedUsers()" class="hover:bg-[#62CEEA]/5 transition-colors">
                        
                        <td class="px-6 py-4">
                            <span class="font-mono text-xs font-bold text-slate-500">#{{ u.usuario_id }}</span>
                        </td>

                        <td class="px-6 py-4">
                            <div>
                                <p class="text-sm font-bold text-slate-800 capitalize">{{ u.nombre_completo }}</p>
                                <p class="text-xs text-slate-500">{{ u.correo }}</p>
                            </div>
                        </td>

                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium border capitalize"
                                [ngClass]="{
                                    'bg-purple-50 text-purple-700 border-purple-200': u.nombre_rol === 'administrador',
                                    'bg-blue-50 text-blue-700 border-blue-200': u.nombre_rol === 'soporte',
                                    'bg-slate-50 text-slate-700 border-slate-200': u.nombre_rol === 'solicitante'
                                }">
                                {{ u.nombre_rol }}
                            </span>
                        </td>

                        <td class="px-6 py-4">
                            <span *ngIf="u.nombre_unidad" class="text-sm text-slate-700 capitalize">{{ u.nombre_unidad }}</span>
                            <span *ngIf="!u.nombre_unidad" class="text-xs text-slate-400 italic">--</span>
                        </td>

                        <td class="px-6 py-4">
                            <div class="flex items-center justify-center gap-2">
                                <button (click)="modalRol = u" title="Cambiar Rol"
                                    class="p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition-colors border border-transparent hover:border-blue-200">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>
                                </button>

                                <button (click)="modalUnidad = u" title="Cambiar Unidad"
                                    class="p-2 rounded-lg text-emerald-600 hover:bg-emerald-50 transition-colors border border-transparent hover:border-emerald-200">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                                </button>

                                <button (click)="modalPassword = u" title="Cambiar Contraseña"
                                    class="p-2 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 flex items-center justify-between">
            <p class="text-sm text-slate-600">
                Pagina <span class="font-bold">{{ currentPage }}</span> de <span class="font-bold">{{ totalPages }}</span>
            </p>
            <div class="flex gap-2">
                <button (click)="previousPage()" [disabled]="currentPage === 1"
                    class="px-3 py-1.5 rounded-lg border border-slate-300 bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 text-xs font-bold uppercase">
                    Anterior
                </button>
                <button (click)="nextPage()" [disabled]="currentPage === totalPages"
                    class="px-3 py-1.5 rounded-lg border border-slate-300 bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 text-xs font-bold uppercase">
                    Siguiente
                </button>
            </div>
        </div>
    </div>

    <div *ngIf="modalRol" class="fixed inset-0 bg-[#002777]/40 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
                <h3 class="text-lg font-bold text-[#002777]">Cambiar Rol</h3>
                <p class="text-sm text-slate-500">Usuario: {{ modalRol.nombre_completo }}</p>
            </div>
            <div class="p-6">
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nuevo Rol</label>
                <select #rolRef class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-[#62CEEA] focus:border-[#002777] outline-none bg-white">
                    <option value="1" [selected]="modalRol.rol_id == 1">Solicitante</option>
                    <option value="2" [selected]="modalRol.rol_id == 2">Soporte</option>
                    <option value="3" [selected]="modalRol.rol_id == 3">Administrador</option>
                </select>
                <div class="flex justify-end gap-3 mt-6">
                    <button (click)="modalRol = null" class="px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium">Cancelar</button>
                    <button (click)="cambiarRol(modalRol.usuario_id, convertRol(rolRef.value)); modalRol = null" 
                        class="px-4 py-2 bg-[#002777] text-white rounded-lg hover:bg-blue-900 font-medium shadow-sm">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="modalUnidad" class="fixed inset-0 bg-[#002777]/40 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
                <h3 class="text-lg font-bold text-[#002777]">Cambiar Unidad</h3>
                <p class="text-sm text-slate-500">Usuario: {{ modalUnidad.nombre_completo }}</p>
            </div>
            <div class="p-6">
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nueva Unidad</label>
                <select #unidadRef class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-[#62CEEA] focus:border-[#002777] outline-none bg-white">
                    <option value="null">-- Sin unidad --</option>
                    <option value="1" [selected]="modalUnidad.unidad_id == 1">Soporte</option>
                    <option value="2" [selected]="modalUnidad.unidad_id == 2">Infraestructura</option>
                    <option value="3" [selected]="modalUnidad.unidad_id == 3">Desarrollo</option>
                </select>
                <div class="flex justify-end gap-3 mt-6">
                    <button (click)="modalUnidad = null" class="px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium">Cancelar</button>
                    <button (click)="cambiarUnidad(modalUnidad.usuario_id, convertUnidad(unidadRef.value)); modalUnidad = null" 
                        class="px-4 py-2 bg-[#002777] text-white rounded-lg hover:bg-blue-900 font-medium shadow-sm">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="modalPassword" class="fixed inset-0 bg-[#002777]/40 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
                <h3 class="text-lg font-bold text-[#002777]">Restablecer Contraseña</h3>
                <p class="text-sm text-slate-500">Usuario: {{ modalPassword.nombre_completo }}</p>
            </div>
            <div class="p-6">
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nueva Contraseña</label>
                <input #passRef type="password" placeholder="Escribe la nueva contraseña..." 
                    class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-[#62CEEA] focus:border-[#002777] outline-none">
                <p class="text-xs text-orange-600 mt-2">⚠️ Esta acción no se puede deshacer.</p>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button (click)="modalPassword = null" class="px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg font-medium">Cancelar</button>
                    <button (click)="cambiarPassword(modalPassword.usuario_id, passRef.value); modalPassword = null" 
                        class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium shadow-sm">Cambiar</button>
                </div>
            </div>
        </div>
    </div>

</div>